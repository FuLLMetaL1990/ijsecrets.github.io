<!doctype html> <html lang=en> <head> <meta charset=utf-8 /> <title>Ruby on Rails 6: Week 1 — ejelome</title> <meta content="Ruby on Rails 6: Week 1" name=title /> <meta content="Week 1 summary of the learned lessons from The Pragmatic Studio's Ruby on Rails 6 course." name=description /> <meta content=ejelome name=author /> <meta content="width=device-width,initial-scale=1" name=viewport /> <link href=/img/favicon.ico rel="shortcut icon" type=image/x-icon /> <link href=https://ejelome.com/blog/ruby-on-rails-6-week-1 rel=canonical /> <script>var script=document.createElement("script");function gtag(){dataLayer.push(arguments)}script.src="//googletagmanager.com/gtag/js?id=UA-144170438-1",document.head.appendChild(script),window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-144170438-1")</script> <script src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js async data-ad-client=ca-pub-3560971753878587></script> <link href=/css/styles.css rel=stylesheet /> </head> <body class=posts> <div class=wrapper> <div class=header> <a href=/ class=navbar-brand> <img alt=ejelome class=site-logo height=64 src=/img/logo.png width=64 /> </a> <div class=site-info> <a href=/ class=site-title>ejelome</a> <p class=site-tagline>Research, Design and Development</p> </div> <ul class=social-media> <li class=github> <a href=https://github.com/ejelome rel=nofollow title="GitHub Profile" class=btn data-placement=top data-toggle=tooltip> <i class="fa-2x fab fa-github"> </i> </a> </li> <li class=youtube> <a href=https://www.youtube.com/channel/UCgqy7fcflZb5hhfLAUmlc5g rel=nofollow title="Youtube Channel" class=btn data-placement=top data-toggle=tooltip> <i class="fa-2x fab fa-youtube"> </i> </a> </li> <li class=linkedin> <a href=https://linkedin.com/in/ejelome rel=nofollow title="LinkedIn Profile" class=btn data-placement=top data-toggle=tooltip> <i class="fa-2x fab fa-linkedin"> </i> </a> </li> </ul> </div> <div class=siri-container> </div> <div class="nav site-nav"> <ul class=list-inline> <li class=list-inline-item> <a href=/ >Home</a> </li> <li class=list-inline-item> <a href=/about>About</a> </li> <li class=list-inline-item> <a href=/archives>Archives</a> </li> </ul> </div> <div class="breadcrumb breadcrumbs"> <a href=/ >Home</a> <span class=separator> <i class="separator fa-caret-right fas"> </i> </span> <a href=/blog>Blog</a> <span class=separator> <i class="separator fa-caret-right fas"> </i> </span> <strong class=active>Ruby on Rails 6: Week 1</strong> </div> <div class=main> <div class=sidebar> <div class="sticky-top toc"> <strong>Table of Contents</strong> </div> </div> <div class=content> <h1>Ruby on Rails 6: Week 1</h1> <div class=post-content> <div class=post-meta> <span class=author> <i class="fas fa-user"> </i> <a href=/about#about data-toggle=tooltip data-placement=top>ejelome</a> </span> <span class=separator>/</span> <span class=published> <i class="fa-clock far"> </i> <time data-placement=top data-toggle=tooltip datetime=2019-09-29T00:00Z title="Published Date">September 29, 2019</time>  <span class=separator>/</span> <span class=tags> <i class="fas fa-tags"> </i> <a href=/tags/research class=tag data-placement=top data-toggle=tooltip title="Posts tagged with research">research</a> <span class=separator>▪</span> <a href=/tags/ruby class=tag data-placement=top data-toggle=tooltip title="Posts tagged with ruby">ruby</a> <span class=separator>▪</span> <a href=/tags/ruby-on-rails class=tag data-placement=top data-toggle=tooltip title="Posts tagged with ruby-on-rails">ruby-on-rails</a> <span class=separator>▪</span> <a href=/tags/web-application-framework class=tag data-placement=top data-toggle=tooltip title="Posts tagged with web-application-framework">web-application-framework</a> </span> </div> <div class="jumbotron post-summary"> <h2>Summary</h2> <p> Ruby on Rails is a server-side web application framework written in the Ruby programming language. It has strong emphasis on conventions (hence, Convention over Configuration or CoC) including Web standards, MVC, DRY and Active Record Pattern. It is geared towards programmer happiness and productivity by alleviating repetitive and tedious tasks through migrations, scaffolding and Rapid Application Development (RAD). This document will be about 1) introduction and setup, 2) create the app, 3) views and controllers, 4) models, 5) connecting MVC, 6) migrations, 7) view helpers and 8) layouts. </p> </div> <hr/> <div class=content-block> <p>So after learning <a href=https://www.ruby-lang.org rel=nofollow>Ruby</a> through <a href=https://pragmaticstudio.com rel=nofollow>Pragmatic Studio</a>'s <a href=https://pragmaticstudio.com/courses/ruby rel=nofollow>Ruby Programming</a> course, it's time to learn <a href=https://rubyonrails.org rel=nofollow>Ruby on Rails</a> through their other course: <a href=https://pragmaticstudio.com/courses/rails rel=nofollow>Ruby on Rails 6</a>.</p><p>It's unfortunate that there was no corresponding course plan so I decided to split the whole learned materials into weeks (8 lessons per week) to avoid getting overwhelmed and not affect my work and life priorities.</p><p>There was also no corresponding reference book used so it will be a plain re-iteration of what have been learned throughout the course's video lessons.</p><p>At least, there were these extra documents provided that will come in handy along the way:</p><ul><li><a href=https://pragmaticstudio.s3.amazonaws.com/courses/rails/Rails-Cheats.pdf rel=nofollow>Rails commands and methods</a> for commonly used Rails commands</li><li><a href=https://pragmaticstudio.s3.amazonaws.com/courses/rails/Rails-Conventions.pdf rel=nofollow>Rails conventions</a> to make sense of Rails' design decisions</li><li><a href=https://pragmaticstudio.com/tutorials/rails-console-shortcuts-tips-tricks rel=nofollow>Console shortcuts, tips, and tricks</a> to better utilize the Rails console</li></ul><p>Finally, before starting, don't forget to read <a href=https://rubyonrails.org/doctrine rel=nofollow>The Rails Doctrine</a> to know <strong>WHY</strong> (or not) one should use Rails.</p><h2>Introduction and Setup</h2><h3 id=install_rails>Install Rails</h3><p><strong>Note:</strong> This will install <a href=https://rubyonrails.org rel=nofollow>Ruby on Rails</a> thru <a href=https://rvm.io rel=nofollow>RVM</a>.</p><ol><li>Install <a href=https://gnupg.org rel=nofollow title='GNU Privacy Guard'>GPG</a> keys:<pre><code class=shell>$ gpg2 --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 \
                   7D2BAF1CF37B13E2069D6956105BD0E739499BDB
</code></pre></li><li>Install <code>rvm</code> with <code>rails</code>:<pre><code class=shell>$ curl -sSL https://get.rvm.io | bash -s stable --rails
</code></pre></li><li>Source <code>rvm</code>:<pre><code class=shell>$ echo "
source ~/.rvm/scripts/rvm
" >> ~/.bashrc
. ~/.bashrc
</code></pre></li></ol><h3 id=install_yarn>Install Yarn</h3><ol><li>Install <a href=https://yarnpkg.com rel=nofollow>yarn</a>:<pre><code class=shell>$ sudo pacman -S yarn
</code></pre></li></ol><h2>Create the App</h2><h3 id=the_skeleton_app>The skeleton app</h3><p><strong>Note:</strong> Just entering <code>rails</code> will display common commands.</p><ol><li>Create a <code>rails</code> app:<pre><code class=shell>$ rails new &lt;project>
</code></pre> This command will:<ol><li>Create a <code>rails</code> skeleton (app structure)</li><li>Install gem dependencies</li><li>Install <code>webpacker</code></li><li>Install JS dependencies using <code>webpacker</code></li></ol></li><li>Move to directory:<pre><code class=shell>$ cd &lt;project>
</code></pre></li><li>Run web server:<pre><code class=shell>$ rails s
</code></pre> Then visit <a href=http://localhost:3000>http://localhost:3000</a>. <br/> <strong>Note:</strong> <code>s</code> is a shorthand for <code>server</code>.</li></ol><h3 id=the_app_structure>The app structure</h3><pre><code class=shell>&lt;project>/            # project directory
├── app/              # application code
│   ├── models/       # handle storing and validating data to/from database
│   ├── views/        # handle interaction between controllers and clients
│   ├── controllers/  # handle interaction between views and models
│   ├── helpers/      # utility methods for views
│   ├── assets/       # static files (images, stylesheets)
│   ├── javascript/   # JS modules compiled by Webpack
│   ├── channels/     # real-time features using Action Cable
│   ├── mailers/      # generating and sending e-mails
│   └── jobs/         # running background jobs
├── config/           # application settings
│   ├── environments/ # environment settings
│   ├── initializers/ # startup settings
│   ├── webpack/      # webpack settings
│   └── locales/      # string translations
├── bin/              # command-line scripts
├── storage/          # uploaded files' storage using Active Storage
├── public/           # static files directly served on web server
├── test/             # application test files
├── lib/              # re-usable non-MVC source files
├── vendor/           # third-party dependencies
├── log/              # Rails log files
├── db/               # database and migration files
├── tmp/              # temporary application files
├── Rakefile
├── Gemfile           # application dependencies (gems)
├── Gemfile.lock
├── config.ru
├── babel.config.js
├── postcss.config.js
├── package.json
├── yarn.lock
└── README.md
</code></pre><h2>Views and Controllers</h2><h3 id=request-response>Request-response</h3><pre><code class=shell>           request
/--------\ -------> /--------\
| Client |          | Server |
\--------/ &lt;------- \--------/
           response
</code></pre><ol><li>The <strong>client</strong> (e.g. web browser) sends a <strong>request</strong> to a server</li><li>The <strong>server</strong> (e.g. web server ) returns a <strong>response</strong> to the client</li></ol><h3 id=rails_request-response_lifecycle>Rails request-response lifecycle</h3><pre><code class=shell>               request
/------------\ -------> /------------------------------\
| ---------- |          | ---------------------------- |
| | Client | |          | | Server                   | |
| ---------- |          | ---------------------------- |
|            |          |  |1                     ^    |
|            |          |  v       2              |9   |
|            |          | [Router] -> [[[Controller]]] |
|            |          |              |3  ^     |7 ^  |
|            |          |              v   |6    v  |8 |
|            |          |             [Model]   [View] |
|            |          |              |4  ^           |
|            |          |              v   |5          |
|            |          |             [Database]       |
\------------/ &lt;------- \------------------------------/
               response
</code></pre><ol><li>Once the server receives a request, it passes the request to the <strong>router</strong></li><li>The <strong>router</strong> dispatches the request to the <strong>controller</strong></li><li>The <strong>controller</strong> extracts the request to the <strong>model</strong></li><li>The <strong>model</strong> connects to the <strong>database</strong></li><li>The <strong>database</strong> transacts with the <strong>model</strong></li><li>The <strong>model</strong> informs the changes to the <strong>controller</strong></li><li>The <strong>controller</strong> passes the information to the <strong>views</strong></li><li>The <strong>views</strong> generates the response and passes it to the <strong>controller</strong></li><li>The <strong>controller</strong> passes the response to the server; returning it to the client</li></ol><h3 id=creating_static_app>Creating static app</h3><ol><li>Visit the desired URL (e.g. <a href=http://localhost:3000/pages>http://localhost:3000/pages</a>) <br/>You should get an error:<pre><code class=html>Routing Error

No route matches [GET] "/pages"
</code></pre></li><li>Create a connection to a Controller#Action pair:<pre><code class=ruby># File: config/routes.rb
Rails.application.routes.draw do
  get "pages" => "pages#index"
end
</code></pre> <strong>Notes:</strong><ul><li>The routes decides what controller#action pair to use on a URL pattern</li><li>The URL pattern should be plural as the controller name is plural</li></ul></li><li>Reload the browser <br/>You should get another error:<pre><code class=html>Routing Error

uninitialized constant PagesController
</code></pre> <strong>Note:</strong> <code>uninitialized constant</code> implies that a controller file is missing.</li><li>Create a controller:<pre><code class=shell>$ rails g controller pages
Running via Spring preloader in process 54191
      create  app/controllers/pages_controller.rb
      invoke  erb
      create    app/views/pages
      invoke  test_unit
      create    test/controllers/pages_controller_test.rb
      invoke  helper
      create    app/helpers/pages_helper.rb
      invoke    test_unit
      invoke  assets
      invoke    scss
      create      app/assets/stylesheets/pages.scss
</code></pre> <strong>Notes:</strong><ul><li><code>g</code> is a shorthand for <code>generate</code></li><li>The controller name must be plural</li></ul></li><li>Reload the browser <br/>You should get another error:<pre><code class=html>Routing Error

The action 'index' could not be found for PagesController
</code></pre> <strong>Note:</strong> <code>Unknown action</code> implies that the action isn't defined in the controller.</li><li>Create a method corresponding to the controller action:<pre><code class=ruby># File: app/controllers/pages_controller.rb
class PagesController &lt; ApplicationController
  def index
  end
end
</code></pre></li><li>Reload the browser <br/>You should get another error:<pre><code class=html>No template for interactive request

PagesController#index is missing a template for request formats: text/html
</code></pre> <strong>Notes:</strong><ul><li>The controller looks for the file: <code>app/views/pages/index.html.erb</code></li></ul></li><li>Create the view:<pre><code class=shell># File: app/views/pages/index.html.erb
$ echo '
&lt;h1>Hello World!&lt;/h1>
' > app/views/pages/index.html.erb
</code></pre> <strong>Note:</strong> Views use the <a href=https://ruby-doc.org/stdlib-2.6.4/libdoc/erb/rdoc/ERB.html rel=nofollow>ERB</a> templating system.</li><li>Reload the browser <br/>You should see the text:<pre><code class=html>Hello World!
</code></pre></li></ol><h3 id=creating_dynamic_app>Creating dynamic app</h3><ol><li>Prepare the data in the controller:<pre><code class=ruby># File: app/controllers/pages_controller.rb
class PagesController &lt; ApplicationController
  def index
    @title = "Hello World!"
    @messages = ["foo", "bar", "baz"]
  end
end
</code></pre> <strong>Note:</strong> Instance variables (e.g. <code>@title</code>, <code>@messages</code>) contains the data that are passed to the views.</li><li>Render the instance variables in the views:<pre><code class=html>&lt;%# File: app/views/pages/index.html.erb %>
&lt;h1>&lt;%= @title %>&lt;/h1>
&lt;ul>
    &lt;% @messages.each do |message|  %>
    &lt;li>&lt;%= message %>&lt;/li>
    &lt;% end %>
&lt;/ul>
</code></pre> <strong>Notes:</strong><ul><li>Use <code>&lt;%# %></code> to place a comment</li><li>Use <code>&lt;%= %></code> to do variable substitution</li><li>Use <code>&lt;% %></code> (scriptlets) to just execute blocks of Ruby code</li></ul></li><li>Visit <a href=http://localhost:3000/pages>http://localhost:3000/pages</a> <br/>You should see the text:<pre><code class=html>Hello World!

* foo
* bar
* baz
</code></pre></li></ol><p><strong>Notes:</strong></p><ul><li>The controller prepares the data</li><li>The view simply renders the data</li></ul><h3 id=web_server_logs>Web server logs</h3><ul><li>Every request-response cycle is logged in the console:<pre><code class=shell>Started GET "/pages" for ::1 at 2019-10-03 20:01:00 +0200
   (0.2ms)  SELECT sqlite_version(*)
Processing by PagesController#index as HTML
  Rendering pages/index.html.erb within layouts/application
  Rendered pages/index.html.erb within layouts/application (Duration: 0.4ms | Allocations: 170)
Completed 200 OK in 9ms (Views: 7.7ms | ActiveRecord: 0.0ms | Allocations: 6114)
</code></pre></li><li>On development, all the logs will be stored at <code>log/development.log</code></li></ul><h2>Models</h2><h3 id=creating_database>Creating database</h3><ol><li>Create a model:<pre><code class=shell>$ rails g model page title:string message:string
Running via Spring preloader in process 63127
      invoke  active_record
      create    db/migrate/20191004093650_create_pages.rb
      create    app/models/page.rb
      invoke    test_unit
      create      test/models/page_test.rb
      create      test/fixtures/pages.yml
</code></pre> <strong>Notes:</strong><ul><li><code>g</code> is a shorthand for <code>generate</code></li><li>The model name must be singular</li><li>Attributes are specified as <code>&lt;field>:&lt;type></code></li><li>Each model attributes represent a database column (except <code>id</code>, <code>created_at</code> and <code>updated_at</code>)</li></ul></li></ol><ol><li>Create the table:<pre><code class=shell># db/migrate/20191004101942_create_pages.rb
$ rails db:migrate
== 20191004101942 CreatePages: migrating ======================================
-- create_table(:pages)
   -> 0.0019s
== 20191004101942 CreatePages: migrated (0.0023s) =============================
</code></pre> <strong>Notes:</strong><ul><li>Tables are created or modified only after the migration files are applied</li><li>Migration files are used to determine how to change the database schema</li><li>Migration files executes <code>.timestamp</code> which adds two timestamp columns (<code>created_at</code> and <code>updated_at</code>)</li><li>Migration is part of Rake tasks (type <code>rails -T</code> to see all Rake tasks or <code>rails -T db</code> for <code>db</code>-specific tasks)</li></ul></li><li>Check migration status:<pre><code class=shell>$ rails db:migrate:status

database: db/development.sqlite3

 Status   Migration ID    Migration Name
--------------------------------------------------
   up     20191004101942  Create pages
</code></pre> <strong>Notes:</strong><ul><li>Database configuration is found at <code>config/database.yml</code></li><li>The database configuration determines the environment to use (<code>development</code>, <code>test</code>, or <code>production</code>)</li><li>By default, Rails uses the <code>development</code> environment</li></ul></li></ol><p><strong>Notes:</strong></p><ul><li>A corresponding table created is named plural</li><li>A model wraps a table to conveniently perform <a href=https://en.wikipedia.org/wiki/Create,_read,_update_and_delete rel=nofollow>CRUD</a> operations</li><li>The <code>id</code> column contains the primary key of each row</li><li>The <code>created_at</code> column contains the timestamp when the row was created</li><li>The <code>updated_at</code> column contains the timestamp when the row was modified</li></ul><h3 id=rails_console>Rails console</h3><p><strong>Note:</strong> The Rails console is a CLI to access the database thru an IRB session.</p><pre><code class=shell>$ rails c
</code></pre><p><strong>Notes:</strong></p><ul><li><code>c</code> is a shorthand for <code>console</code></li><li>Type <code>exit</code> to exit from the console (or <code>ctrl+D</code>)</li><li>Rails console loads the whole environment (e.g. <code>development</code>)</li><li>Use the <code>reload!</code> method to reload the application without reopening the console</li></ul><h3 id=rails_dbconsole>Rails dbconsole</h3><p><strong>Note:</strong> The Rails dbconsole is also a CLI but does direct access to the database.</p><pre><code class=shell>$ rails db
</code></pre><p><strong>Notes:</strong></p><ul><li><code>db</code> is a shorthand for <code>dbconsole</code></li><li>For SQLite, type <code>.quit</code> to exit from the dbconsole (or <code>ctrl+D</code>)</li></ul><h4 id=direct_database_interaction>Direct database interaction</h4><p><strong>Note:</strong> These examples are for the SQLite database.</p><ul><li>List all tables:<pre><code class=sql>sqlite> .tables
ar_internal_metadata  pages  schema_migrations
</code></pre></li><li>List schema of a table:<pre><code class=sql>sqlite> .schema pages
CREATE TABLE IF NOT EXISTS "pages" ...
</code></pre></li><li>Display schema of the schema_migrations table:<pre><code class=sql>sqlite> .schema schema_migrations
CREATE TABLE IF NOT EXISTS "schema_migrations" ...
</code></pre></li><li>Display all executed schema migrations:<pre><code class=sql>sqlite> SELECT * FROM schema_migrations;
20191004101942
</code></pre></li></ul><h3 id=crud_operations>CRUD operations</h3><h4 id=creating_rows>Creating rows</h4><ol><li>Use the <code>new</code> method without arguments to create an object and update its attributes individually:<pre><code class=ruby>>> # Instantiate an object in memory:
>> p = Page.new
   (0.4ms)  SELECT sqlite_version(*)
=> #&lt;Page id: ...

>> # Update attributes:
>> p.title = "Hello World!"
=> "Hello World!"
>> p.message = "Foo Bar Baz"
=> "Foo Bar Baz"

>> # Begin and commit transaction to database:
>> p.save
   (0.2ms)  begin transaction
  Page Create (0.7ms)  INSERT INTO "pages" ...
   (34.9ms)  commit transaction
=> true
</code></pre> <strong>Notes:</strong><ul><li>When using the <code>new</code> method, the <code>save</code> method is required to perform database transactions</li><li>The return value <code>true</code> implies that the database transaction went successful</li></ul></li><li>Use the <code>new</code> method with arguments (a hash) to create an object with updated attributes:<pre><code class=ruby>>> # Instantiate an object in memory:
>> p = Page.new(title: "Hello World!", message: "Foo Bar Baz")
=> #&lt;Page id: ...

>> # Begin and commit transaction to database:
>> p.save
   (0.2ms)  begin transaction
  Page Create (0.8ms)  INSERT INTO "pages" ...
   (12.1ms)  commit transaction
 => true
</code></pre> <strong>Note:</strong> Using the <code>new</code> method with arguments saves the time of updating attributes manually.</li><li>Use the <code>create</code> method to create an object with attributes and perform database transactions automatically:<pre><code class=ruby>>> # Instantiate an object in memory then begin and commit transaction to database:
>> p = Page.create(title: "Hello World!", message: "Foo Bar Baz")
   (0.2ms)  begin transaction
  Page Create (0.8ms)  INSERT INTO "pages" ...
   (11.4ms)  commit transaction
=> #&lt;Page id: ...
</code></pre></li></ol><h4 id=reading_rows>Reading rows</h4><ul><li>Use the <code>count</code> method to count all rows in the database:<pre><code class=ruby>>> Page.count
Page.count
   (0.4ms)  SELECT sqlite_version(*)
   (0.1ms)  SELECT COUNT(*) FROM "pages"
 => 1
</code></pre></li><li>Use the <code>all</code> method to return all rows as objects:<pre><code class=ruby>>> Page.all
  Page Load (0.7ms)  SELECT "pages".* ...
=> #&lt;ActiveRecord::Relation [#&lt;Page id: ...
</code></pre></li><li>Use the <code>find</code> method to find a row using the primary key:<pre><code class=ruby>>> Page.find(1)
  Page Load (0.2ms)  SELECT "pages".* ...
=> #&lt;Page id: ...
</code></pre></li><li>The <code>find</code> method will return an exception if the primary key does not exist:<pre><code class=ruby>>> Page.find(10)
  Page Load (0.3ms)  SELECT "pages".* ...
Traceback (most recent call last):
        1: from (irb):4
ActiveRecord::RecordNotFound (Couldn't find Page with 'id'=10)
</code></pre></li><li>Use the <code>find_by</code> method to find a row with using a column name and its value:<pre><code class=ruby>>> Page.find_by(title: "Hello World!")
  Page Load (0.6ms)  SELECT "pages".* ...
 => #&lt;Page id: ...
</code></pre></li><li>The <code>find_by</code> method will return <code>nil</code> the column value does not exist:<pre><code class=ruby>>> Page.find_by(title: "Hello Universe!")
  Page Load (0.4ms)  SELECT "pages".* ...
=> nil
</code></pre></li></ul><h4 id=updating_rows>Updating rows</h4><ul><li>Use the <code>update</code> method to update a row:<pre><code class=ruby>>> # Find a row from the database and get it as an object:
>> p = Page.find_by(title: "Hello World!")
  Page Load (0.4ms)  SELECT "pages".* ...
=> #&lt;Page id: ...

>> # Update the column by updating the object's attributes:
>> p.update(message: "Baz Bar Foo")
   (0.2ms)  begin transaction
  Page Update (26.1ms)  UPDATE "pages" ...
   (12.2ms)  commit transaction
=> true
</code></pre></li></ul><h4 id=deleting_rows>Deleting rows</h4><ul><li>Use the <code>destroy</code> method to delete a row:<pre><code class=ruby>>> # Find a row from the database and get it as an object:
>> p = Page.find_by(title: "Hello World!")
  Page Load (0.4ms)  SELECT "pages".* ...
=> #&lt;Page id: ...

>> # Delete a row:
>> p.destroy()
   (0.2ms)  begin transaction
  Page Destroy (0.7ms)  DELETE FROM "pages" ...
   (11.6ms)  commit transaction
 => #&lt;Page id: ...
</code></pre></li></ul><h2>Connecting MVC</h2><h3 id=putting_the_pieces_together>Putting the pieces together</h3><ol><li>Update the controller:<pre><code class=ruby># File: app/controllers/pages_controller.rb
class PagesController &lt; ApplicationController
  def index
    @pages = Page.all
  end
end
</code></pre> <strong>Notes:</strong><ul><li>The <code>index</code> action is intended to display the <strong>list</strong> of all the rows of a table</li><li>The <code>Page</code> class is automatically available as part of the <strong>convention</strong></li></ul></li><li>Update the views:<pre><code class=html>&lt;%# File: app/views/pages/index.html.erb %>
&lt;ul>
    &lt;% @pages.each do |p|  %>
    &lt;li>
        &lt;%= p.title %>: &lt;%= p.message %>
    &lt;/li>
    &lt;% end %>
&lt;/ul>
</code></pre></li><li>Visit <a href=http://localhost:3000/pages>http://localhost:3000/pages</a> <br/>You should see the text:<pre><code class=html>* Hello World!: Foo Bar Baz
</code></pre></li></ol><h3 id=separation_of_concerns>Separation of concerns</h3><h4 id=model>Model</h4><ul><li>Transacts with the database table</li><li>Returns table rows as objects to the controller</li><li>Handles business logic (fat model, skinny controller)</li><li>Doesn't know anything about the view</li></ul><h4 id=view>View</h4><ul><li>Uses the data passed by the controller</li><li>Generates an output to be sent back to the controller</li><li>Doesn't know anything about the model</li></ul><h4 id=controller>Controller</h4><ul><li>Gets the data from the model</li><li>Assigns the data as instance variables to the view</li><li>Renders the view</li><li>Decides what the model should do (but don't care how the model does it)</li><li>Decides what views to render (but don't care how the views does it)</li></ul><h2>Migrations</h2><ul><li>Create a new migration:<pre><code class=shell>$ rails g migration AddSlugExcerptToPages slug:string excerpt:string
Running via Spring preloader in process 306218
      invoke  active_record
      create    db/migrate/20191005184209_add_slug_excerpt_to_pages.rb
</code></pre> <strong>Notes:</strong><ul><li><code>g</code> is a shorthand for <code>generate</code></li><li>The migation table name must be plural</li><li>Use the convention <code>Add&lt;Columns>To&lt;Model>s</code> when adding columns: <br/>e.g.: <code>AddSlugExcerptToPages</code> generates <code>db/migrate/&lt;timestamp>_add_slug_excerpt_to_pages.rb</code></li><li>Use the convention <code>Remove&lt;Columns>From&lt;Model>s</code> when removing columns: <br/>e.g.: <code>RemoveTitleContentFromPages</code> generates <code>db/migrate/&lt;timestamp>_remove_slug_excerpt_from_pages.rb</code></li></ul></li><li>Apply the new migration:<pre><code class=shell>$ rails db:migrate
== 20191005184209 AddSlugExcerptToPages: migrating ============================
-- add_column(:pages, :slug, :string)
   -> 0.0017s
-- add_column(:pages, :excerpt, :string)
   -> 0.0009s
== 20191005184209 AddSlugExcerptToPages: migrated (0.0028s) ===================
</code></pre></li></ul><h2>View Helpers</h2><h3 id=built-in_methods>Built-in methods</h3><pre><code class=html>&lt;%# File: app/views/pages/index.html.erb %>
&lt;ul>
    &lt;% @pages.each do |p|  %>
        &lt;li>
            &lt;a href="/&lt;%= p.title.parameterize %>">&lt;%= p.title %>&lt;/a>
            &lt;p>&lt;%= truncate(p.message, length: 1, separator: " ") %>&lt;/p>
        &lt;/li>
    &lt;% end %>
&lt;/ul>
</code></pre><p><strong>Notes:</strong></p><ul><li>Built-in view helpers are out-of-the box methods to help solve common view problems</li><li>These methods are readily available in the view (e.g. <code>app/views/pages/index.html.erb</code>)</li><li>In the above example, both <code>parametarize</code> and <code>truncate</code> are the built-in methods</li><li>See <a href=https://github.com/rails/rails/tree/master/actionview/lib/action_view/helpers rel=nofollow>rails/actionview/lib/action_view/helpers</a> for the complete list of built-in view helpers</li></ul><h3 id=custom_methods>Custom methods</h3><ol><li>Create a custom method in the view helper:<pre><code class=ruby># File: app/helpers/pages_helper.rb
module PagesHelper
  def dunderify(page)
    page.title.parameterize.underscore
  end
end
</code></pre></li><li>Use it in the view:<pre><code class=html>&lt;%# File: app/views/pages/index.html.erb %>
&lt;ul>
    &lt;% @pages.each do |p|  %>
        &lt;li>
            &lt;a href="/&lt;%= dunderify(p) %>">&lt;%= p.title %>&lt;/a>
            &lt;p>&lt;%= truncate(p.message, length: 1, separator: " ") %>&lt;/p>
        &lt;/li>
    &lt;% end %>
&lt;/ul>
</code></pre></li></ol><p><strong>Notes:</strong></p><ul><li>Custom view helpers are manually created methods to help solve unique problems</li><li>These custom methods are created in <code>app/helpers/pages_helper.rb</code></li><li>In the above example, the <code>dunder</code> method slugifies then separate words with underscore</li></ul><h3 id=business_logic>Business logic</h3><ol><li>Create a method in the model:<pre><code class=ruby># File: app/models/page.rb
class Page &lt; ApplicationRecord
  def has_crap?
    title.downcase =~ /crap/
  end
end
</code></pre> <strong>Note:</strong> There's no need to put <code>self</code> before the <code>title</code> attribute since <code>self</code> refers to <code>Page</code> as context.</li><li>Create a method in the view helper using it:<pre><code class=ruby># File: app/helpers/pages_helper.rb
module PagesHelper
  ...

  def title(page)
    if page.has_crap?
      "Not allowed"
    else
      page.title
    end
  end
end
</code></pre></li><li>Use it in the view:<pre><code class=ruby>&lt;%# File: app/views/pages/index.html.erb %>
&lt;ul>
    &lt;% @pages.each do |p|  %>
        &lt;li>
            &lt;a href="/&lt;%= dunderify(p) %>">&lt;%= title(p) %>&lt;/a>
            &lt;p>&lt;%= truncate(p.message, length: 1, separator: " ") %>&lt;/p>
        &lt;/li>
    &lt;% end %>
&lt;/ul>
</code></pre></li></ol><p><strong>Notes:</strong></p><ul><li>Business logic implements the unique business requirements (business rules)</li><li>The business logic are created directly in the model (e.g. <code>app/models/page.rb</code>)</li><li>In the above example, the <code>has_crap?</code> method check if the string has the word <code>crap</code></li></ul><h2>Layouts</h2><h3 id=base>Base</h3><pre><code class=html>&lt;%# File: app/views/layouts/application.html.erb %>
&lt;!DOCTYPE html>
&lt;html>
  &lt;head>
    &lt;title>Ror6Course&lt;/title>
    &lt;%= csrf_meta_tags %>
    &lt;%= csp_meta_tag %>

    &lt;%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    &lt;%= javascript_pack_tag 'application', 'data-turbolinks-track': 'reload' %>
  &lt;/head>

  &lt;body>
    &lt;%= yield %>
  &lt;/body>
&lt;/html>
</code></pre><p><strong>Notes:</strong></p><ul><li>The <code>csrf_meta_tags</code> generates a csrf token to protect from cross-site request forgery</li><li>The <code>csp_meta_tag</code> generates a nonce to protect from replay attacks</li><li>The <code>stylesheet_link_tag</code> generates the style sheet (css) link tag</li><li>The <code>javascript_pack_tag</code> generates the javascript (js) script tag</li><li>The <code>yield</code> is substituted according to the action file used (e.g. <code>index.html.erb</code>)</li></ul><h3 id=example>Example</h3><pre><code class=html>&lt;%# File: app/views/layouts/application.html.erb %>
&lt;!DOCTYPE html>
&lt;html>
  &lt;head>
    &lt;title>Ror6Course&lt;/title>
    &lt;%= csrf_meta_tags %>
    &lt;%= csp_meta_tag %>
    &lt;%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    &lt;%= javascript_pack_tag 'application', 'data-turbolinks-track': 'reload' %>
  &lt;/head>
  &lt;body>
    &lt;header>
      &lt;h1>Ror6Course&lt;/h1>
    &lt;/header>
    &lt;main>
      &lt;%= yield %>
    &lt;/main>
    &lt;footer>
      &lt;p>Copyright &ampcopy;
        &lt;%= Time.now.year %>
        &lt;a href="/">Ror6Course&lt;/a>.
        Some rights reserved.
      &lt;/p>
    &lt;/footer>
  &lt;/body>
&lt;/html>
</code></pre><p>Let's continue to the second week: <a href=ruby-on-rails-6-week-2 rel=nofollow>Ruby on Rails 6: Week 2</a>.</p> </div> </div> <div class=pagination> <a href=/blog/ruby-on-rails-6-week-2 class="btn btn-outline-secondary previous"> <i class="fas fa-angle-left"> </i> Ruby on Rails 6: Week 2 </a> <div class=separator> <i class="fas fa-yin-yang"> </i> </div> <a href=/blog/ruby-programming-part-4 class="btn btn-outline-secondary next">Ruby Programming: Part 4 <i class="fas fa-angle-right"> </i> </a> </div> <hr/> <div class=post-comments> <h2>Comments</h2> <div id=disqus_thread> </div> <script>var disqus_config=function(){this.page.url="https://ejelome.com/blog/ruby-on-rails-6-week-1",this.page.identifier="Ruby on Rails 6: Week 1"};!function(){var e=document,t=e.createElement("script");t.src="//ejelome.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)}()</script> <noscript>Please enable JavaScript to view the <a href=//disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a> </noscript> </div> </div> </div> </div> <div class=footer> <p>Copyright © 2019 <a href=/ >ejelome</a>. Some rights reserved. </p> </div> <script src=/js/scripts.js></script> </body> </html> 